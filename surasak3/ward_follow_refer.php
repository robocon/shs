<?php
session_start();

include("connect.inc");

$list_ptright["P02"] = "ทหาร (น)";
$list_ptright["P03"] = "ทหาร (นส)";
$list_ptright["P04"] = "ทหาร (พลฯ)";
$list_ptright["P05"] = "ครอบครัว";
$list_ptright["P06"] = "พ.ต้น";
$list_ptright["P07"] = "พ.";
$list_ptright["P08"] = "ประกันสังคม";
$list_ptright["P09"] = "30บาท";
$list_ptright["P10"] = "30บาทฉุกเฉิน";
$list_ptright["P11"] = "พรบ.";
$list_ptright["P12"] = "กท.44";

if(isset($_POST["row_id"]) && $_POST["row_id"] !=""){
	
	if($_POST["hospital1"] != ""){
		$_POST["hospital"] = $_POST["hospital1"];
	}

	if($_POST["exrefer2"] != ""){
		$_POST["exrefer"] = $_POST["exrefer2"];
	}


	$sql = "Update `refer` set `referh` = '".$_POST["hospital"]."' ,`pttype` = '".$_POST["pttype"]."' ,`diag` = '".$_POST["diag"]."'  ,`exrefer` = '".$_POST["exrefer"]."' ,`refercar` = '".$_POST["refercar"]."' ,`office` = '".$_SESSION["sOfficer"]."' ,`doctor` = '".$_POST["doctor"]."', type_wound='".$_POST["type_wound"]."', problem_refer = '".$_POST["problem_refer"]."', follow_refer = '".$_POST["follow_refer"]."' Where row_id = '".$_POST["row_id"]."'";

	$result = Mysql_Query($sql) or die(Mysql_Error());
	
	echo "
	<SCRIPT LANGUAGE=\"JavaScript\">
		
		window.onload = function(){
			
			setTimeout(\"window.location.href='ward_follow_refer.php';\",3000);

		}
		
		</SCRIPT>
	";
	echo "<BR><CENTER><B>บันทึกข้อมูลเรียบร้อยแล้ว</B><BR><A HREF=\"#\" Onclick=\"window.location.href='ward_follow_refer.php';\">&lt;&lt; กลับ</A></CENTER>";

exit();
}

?>
<html>
<head>
<title>ผู้ป่วย Refer จาก Ward</title>
<style type="text/css">


a:link {color:#FF0000; text-decoration:underline;}
a:visited {color:#FF0000; text-decoration:underline;}
a:active {color:#FF0000; text-decoration:underline;}
a:hover {color:#FF0000; text-decoration:underline;}

body,td,th {
	font-family:  MS Sans Serif;
	font-size: 14 px;
}

.font_title{
	font-family:  MS Sans Serif;
	font-size: 14 px;
	color:#FFFFFF;
	font-weight: bold;

}
</style>
</head>
<body>
<?php if(empty($_GET["view"])){?>
<A HREF="../nindex.htm">&lt; &lt; เมนู</A>
	
	<TABLE width="100%" border="0">
	<TR>
		<TD>
		<FORM METHOD=POST ACTION="">
		<TABLE border="1" bordercolor="#3366FF">
		<TR>
			<TD class="font_title" align="center" bgcolor="#3366FF">
		<B>ค้นหา</B>
		</TD>
		</TR>
		<TR>
			<TD>
			HN : <INPUT TYPE="text" NAME="search_hn" size="10"> หรือ 
			AN : <INPUT TYPE="text" NAME="search_an" size="10"><BR>
			<CENTER><INPUT TYPE="submit" name="submit_search" value="ค้นหา"></CENTER>
		</TD>
		</TR>
		</TABLE>
		</FORM>

<?php
}
if($_POST["submit_search"] == "ค้นหา" || $_GET["view"] == 'opd'){

if($_REQUEST["search_hn"] == "" && $_GET["view"] == 'opd' ){
	echo "<CENTER><FONT SIZE=\"4\" >กรุณากรอก HN ด้วยครับ</FONT></CENTER>";
	exit();
}

if($_REQUEST["search_hn"] != ""){
	$where = " a.hn='".$_REQUEST["search_hn"]."' ";
}else if($_POST["search_an"] != ""){
	$where = " a.an='".$_POST["search_an"]."' ";
}else{
	exit();
}

$sql = "Select a.row_id, a.name, a.sname, a.hn, a.an, date_format(a.dateopd,'%d-%m-%Y')  From refer as a Where ".$where." AND ward !='ER' Order by a.row_id DESC  ";

$result = mysql_query($sql);

echo "<table width=\"90%\"  border=\"1\" bordercolor=\"#3366FF\">
  <tr>
    <td ><table width=\"100%\" border=\"0\" align=\"center\">
      <tr align=\"center\" bgcolor=\"#3366FF\" class=\"font_title\">
        <td >HN</td>
		<td >AN</td>
        <td >ชื่อ - สกุล</td>
        <td >วันที่ refer</td>
		<td >แก้ไข</td>
      </tr>";

while(list($row_id, $name, $sname, $hn, $an, $dateopd) = Mysql_fetch_row($result)){
echo "<tr align=\"center\" >
        <td align=\"center\" >".$hn."</td>
		<td align=\"center\" >".$an."</td>
        <td >".$name." ".$sname."</td>
        <td >".$dateopd."</td>
		<td ><A HREF=\"ward_follow_refer.php?edit_refer=edit&search_id=".$row_id."\">แก้ไข</A></td>
      </tr>";
}

	echo "</table>
	</td>
      </tr>
	</table>";

}else if($_GET["edit_refer"] == "edit" && $_GET["search_id"] !=""){

	$sql = "Select a.row_id, a.name, a.sname, a.age, a.hn, a.an, a.type_wound, date_format(b.date,'%d-%m-%Y'), date_format(b.date,'%H:%i'), time_format(a.time_refer,'%H:%i'), a.doctor, a.diag, a.exrefer , a.referh, a.problem_refer, a.pttype, a.refercar, a.list_type_patient, a.follow_refer  From refer as a INNER JOIN ipcard as b ON a.an=b.an Where a.row_id='".$_GET["search_id"]."' Order by a.row_id DESC limit 1 ";
$result = mysql_query($sql);
if(Mysql_num_rows($result) ==0){
	echo "<BR><BR><CENTER>ไม่มีหมายเลข AN นี้</CENTER>";
}else{
	list($row_id, $name, $sname, $age, $hn, $an, $type_wound, $date, $time_date, $time_refer, $doctor, $diag, $exrefer , $referh, $problem_refer, $pttype, $refercar, $list_type_patient, $follow_refer)=mysql_fetch_row($result);
	
echo "

<FORM METHOD=POST ACTION=\"\">
<TABLE border='1' bordercolor='#0033FF'><TR>
	<TD>
	<!-- รายละเอียดของการ Refer -->
		<TABLE>
		<TR>
			<TD align=\"center\" bgcolor='#0033FF'><FONT  COLOR=\"#FFFFFF\"><B>แก้ไขข้อมูล รายละเอียดของการ Refer</B></FONT></TD>
		</TR>
	<TR>
			<TD> วัน/เดือน/ปีที่มาตรวจ <U>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$date."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</U>&nbsp;เวลา&nbsp;<U>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$time_date."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</U>&nbsp;น.&nbsp;เวลาที่&nbsp;Refer&nbsp;<U>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$time_refer."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</U> น.</TD>
		</TR>
		<TR>
			<TD> ชื่อ-สกลุ<U>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$name."&nbsp;".$sname."&nbsp;&nbsp;&nbsp;&nbsp;</U>&nbsp;&nbsp;อายุ&nbsp;<U>&nbsp;&nbsp;&nbsp;".$age."&nbsp;&nbsp;&nbsp;</U>HN<U>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$hn."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</U>AN<U>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$an."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</U></TD>
		</TR>
		<TR>
			<TD>สิทธิการรักษา&nbsp;:&nbsp;";
			echo "<SELECT NAME=\"type_wound\">
						<Option value='P01' >-------</Option>
						<Option value='P02' ".($type_wound == 'P02' ? ' Selected ':'').">ทหาร (น)</Option>
						<Option value='P03' ".($type_wound == 'P03' ? ' Selected ':'').">ทหาร (นส)</Option>
						<Option value='P04' ".($type_wound == 'P04' ? ' Selected ':'').">ทหาร (พลฯ)</Option>
						<Option value='P05' ".($type_wound == 'P05' ? ' Selected ':'').">ครอบครัว</Option>
						<Option value='P06' ".($type_wound == 'P06' ? ' Selected ':'').">พ.ต้น</Option>
						<Option value='P07' ".($type_wound == 'P07' ? ' Selected ':'').">พ.</Option>
						<Option value='P08' ".($type_wound == 'P08' ? ' Selected ':'').">ประกันสังคม</Option>
						<Option value='P09' ".($type_wound == 'P09' ? ' Selected ':'').">30บาท</Option>
						<Option value='P10' ".($type_wound == 'P10' ? ' Selected ':'').">30บาทฉุกเฉิน</Option>
						<Option value='P11' ".($type_wound == 'P11' ? ' Selected ':'').">พรบ.</Option>
						<Option value='P12' ".($type_wound == 'P12' ? ' Selected ':'').">กท.44</Option>
						</SELECT>";
			
			
			echo "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
		</TR>
		
		<TR>
			<TD>แพทย์ผู้รักษา/Refer&nbsp;:&nbsp;<SELECT NAME=\"doctor\">";
		
	$sql_dc = "Select name From doctor where status = 'y' AND row_id != '0' Order by name ASC ";
	$result_dc = Mysql_Query($sql_dc);
	
	while(list($name) = Mysql_fetch_row($result_dc)){
		echo "<option value=\"".$name."\" ";
			if($doctor == $name) echo " Selected ";
		echo ">".$name."</option>";
	}

		echo "</SELECT>&nbsp;
			</TD>
		</TR>
		<TR>
			<TD>
				การวินิจฉัยโรค </TD>
		</TR>
		<TR>
			<TD>
				&nbsp;&nbsp;&nbsp;&nbsp;<TEXTAREA NAME=\"diag\" ROWS=\"4\" COLS=\"60\">".$diag."</TEXTAREA>";
			
		echo "</TD>
		</TR>
		<TR>
			<TD>สาเหตุการ Refer&nbsp;:&nbsp;<SELECT NAME=\"exrefer\" >
										<Option value=\"\" >-----------------</Option>
										<Option value=\"เตียงเต็ม\" ".($exrefer == 'เตียงเต็ม' ? ' Selected ':'').">เตียงเต็ม</Option>
										<Option value=\"ICU เต็ม\" ".($exrefer == 'ICU เต็ม' ? ' Selected ':'').">ICU เต็ม</Option>
										<Option value=\"Propermangement\" ".($exrefer == 'Propermangement' ? ' Selected ':'').">Propermangement</Option>
										<Option value=\"สิทธิ์รักษา รพ. ลำปาง\" ".($exrefer == 'สิทธิ์รักษา รพ. ลำปาง' ? ' Selected ':'').">สิทธิ์รักษา รพ. ลำปาง</Option>
										<Option value=\"พบแพทย์เฉพาะทาง\" ".($exrefer == 'พบแพทย์เฉพาะทาง' ? ' Selected ':'').">พบแพทย์เฉพาะทาง</Option>
										<Option value=\"ไม่มีเครื่องมือ\" ".($exrefer == 'ไม่มีเครื่องมือ' ? ' Selected ':'').">ไม่มีเครื่องมือ</Option>
										<Option value=\"ไม่มีเลือด\" ".($exrefer == 'ไม่มีเลือด' ? ' Selected ':'').">ไม่มีเลือด</Option>
										<Option value=\"ผู้ป่วย/ญาติต้องการ\" ".($exrefer == 'ผู้ป่วย/ญาติต้องการ' ? ' Selected ':'').">ผู้ป่วย/ญาติต้องการ</Option>
										<Option value=\"อื่นๆ\" ".($exrefer == 'อื่นๆ' ? ' Selected ':'').">อื่นๆ</Option>
										</SELECT>";
			if($exrefer != 'เตียงเต็ม' && $exrefer != 'ICU เต็ม' && $exrefer != 'Propermangement' && $exrefer != 'สิทธิ์รักษา รพ. ลำปาง' && $exrefer != 'พบแพทย์เฉพาะทาง' && $exrefer != 'ไม่มีเครื่องมือ' && $exrefer != 'ไม่มีเลือด' && $exrefer != 'ผู้ป่วย/ญาติต้องการ' && $exrefer != 'อื่นๆ' ){
				$exrefer2 = $exrefer;
			}
			echo "&nbsp;&nbsp;สาเหตุอื่นๆ <INPUT TYPE=\"text\" NAME=\"exrefer2\" size = \"40\" value=\"".$exrefer2."\">";
			echo "</TD>
		</TR>
		<TR>
			<TD> Refer ไปที่โรงพยาบาล&nbsp;:&nbsp;
						<select  name='hospital'>
 <option value='00' >-------------------</option>
 <option value='10672 ลำปาง' ".($referh == '10672 ลำปาง' ? ' Selected ':'').">โรงพยาบาลลำปาง</option>
 <option value='11146 แม่เมาะ' ".($referh == '11146 แม่เมาะ' ? ' Selected ':'').">โรงพยาบาลแม่เมาะ</option>
 <option value='11147 เกาะคา' ".($referh == '11147 เกาะคา' ? ' Selected ':'').">โรงพยาบาลเกาะคา</option>
 <option value='11148 เสริมงาม' ".($referh == '11148 เสริมงาม' ? ' Selected ':'').">โรงพยาบาลเสริมงาม</option>
 <option value='11149 งาว' ".($referh == '11149 งาว' ? ' Selected ':'').">โรงพยาบาลงาว</option>
 <option value='11150 แจ้ห่ม' ".($referh == '11150 แจ้ห่ม' ? ' Selected ':'').">โรงพยาบาลแจ้ห่ม</option>
 <option value='11152 เถิน' ".($referh == '11152 เถิน' ? ' Selected ':'').">โรงพยาบาลเถิน</option>
 <option value='11153 แม่พริก' ".($referh == '11153 แม่พริก' ? ' Selected ':'').">โรงพยาบาลแม่พริก</option>
 <option value='11154 แม่ทะ' ".($referh == '11154 แม่ทะ' ? ' Selected ':'').">โรงพยาบาลแม่ทะ</option>
 <option value='11155 สบปราบ' ".($referh == '11155 สบปราบ' ? ' Selected ':'').">โรงพยาบาลสบปราบ</option>
 <option value='11156 ห้างฉัตร' ".($referh == '11156 ห้างฉัตร' ? ' Selected ':'').">โรงพยาบาลห้างฉัตร</option>
 <option value='11157 เมืองปาน' ".($referh == '11157 เมืองปาน' ? ' Selected ':'').">โรงพยาบาลเมืองปาน</option>
 <option value='12005 แวนแซนวูด' ".($referh == '12005 แวนแซนวูด' ? ' Selected ':'').">โรงพยาบาลแวนแซนวูด</option>
 <option value='อื่นๆ' ".($referh == 'อื่นๆ' ? ' Selected ':'').">อื่นๆ</option>
  </select>";

if($referh != '10672 ลำปาง' && $referh != '11146 แม่เมาะ' && $referh != '11147 เกาะคา' && $referh != '11148 เสริมงาม' && $referh != '11149 งาว' && $referh != '11150 แจ้ห่ม' && $referh != '11152 เถิน' && $referh != '11153 แม่พริก' && $referh != '11154 แม่ทะ'  && $referh != '11155 สบปราบ' && $referh != '11156 ห้างฉัตร' && $referh != '11157 เมืองปาน' && $referh != '12005 แวนแซนวูด' && $referh != 'อื่นๆ' ){
				$referh2 = $referh;
			}
echo "สถานพยาบาลอื่น&nbsp;&nbsp; <input type='text' name='hospital1' size='15' value=\"".$referh2."\">";
	echo "						</TD>
		</TR>
		<TR>
			<TD>7. ปัญหาการ Refer&nbsp;:&nbsp;<INPUT TYPE=\"text\" NAME=\"problem_refer\" value=\"".$problem_refer."\"></TD>
		</TR>
		<TR>
			<TD>8. ประเภท&nbsp;:&nbsp;<INPUT TYPE='radio' NAME='pttype' VALUE='1' ".($pttype == '1' ? ' Checked ':'').">Emergency&nbsp;&nbsp;&nbsp;<INPUT TYPE='radio' NAME='pttype' VALUE='2' ".($pttype == '2' ? ' Checked ':'').">Urgent&nbsp;&nbsp;&nbsp;<INPUT TYPE='radio' NAME='pttype' VALUE='3' ".($pttype == '3' ? ' Checked ':'').">Non-Urgent &nbsp;</TD>
		</TR>
		<TR>
			<TD>9. ประเภทคนไข้&nbsp;:&nbsp;<SELECT NAME='list_type_patient' >
										<Option value=''>--------</Option>
										<Option value='Med'  ".($list_type_patient == 'Med' ? ' Selected ':'').">Med</Option>
										<Option value='Sx'  ".($list_type_patient == 'Sx' ? ' Selected ':'').">Sx</Option>
										<Option value='Ortho' ".($list_type_patient == 'Ortho' ? ' Selected ':'').">Ortho</Option>
										<Option value='OB. Gyne' ".($list_type_patient == 'OB. Gyne' ? ' Selected ':'').">OB. Gyne</Option>
										<Option value='Ped' ".($list_type_patient == 'Ped' ? ' Selected ':'').">Ped</Option>
										<Option value='Eye' ".($list_type_patient == 'Eye' ? ' Selected ':'').">Eye</Option>
										<Option value='Ent' ".($list_type_patient == 'Ent' ? ' Selected ':'').">Ent</Option>
										<Option value='Psycho' ".($list_type_patient == 'Psycho' ? ' Selected ':'').">Psycho</Option>
										</SELECT></TD>
		</TR>
		<TR>
			<TD>10. ไปโดย&nbsp;:&nbsp;<INPUT TYPE='radio' NAME='refercar' VALUE='01 รถพยาบาลไปรับ/ส่ง' ".($refercar == '01 รถพยาบาลไปรับ/ส่ง' ? ' Checked ':'').">รถพยาบาลไปรับ/ส่ง&nbsp;&nbsp;<INPUT TYPE='radio' NAME='refercar' VALUE='02 ผู้ป่วยเดินทางเอง' ".($refercar == '02 ผู้ป่วยเดินทางเอง' ? ' Checked ':'').">ผู้ป่วยเดินทางเอง &nbsp;</TD>
		</TR>
		<TR>
			<TD>11. ผลการติดตามผู้ป่วย</TD>
		</TR>
		<TR>
			<TD>&nbsp;&nbsp;&nbsp;<TEXTAREA NAME=\"follow_refer\" ROWS=\"8\" COLS=\"50\">".$follow_refer."</TEXTAREA></TD>
		</TR>
		<TR>
			<TD align='center'><INPUT TYPE=\"submit\" value=\"ตกลง\"><INPUT TYPE=\"hidden\" name=\"row_id\" value=\"".$row_id."\"></TD>
		</TR>
		</TABLE>
			<!-- รายละเอียดของการ Refer -->
	</TD>
</TR>
</TABLE>
</FORM>	";
}
}
?>

</body>
</html>
<?php include("unconnect.inc");?>
